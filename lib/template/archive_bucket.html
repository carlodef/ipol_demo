<%page args="bucket, tn"/>
<%
images = filter(lambda i : i.is_file and i.has_tn, bucket['files'])
non_images = filter(lambda i : i.is_file and not i.has_tn, bucket['files'])
%>
<div class="bucket">
  <table class="info">
    <tr>
      <th>key</th>
      <td><a href="?key=${bucket['meta']['key'] | h}"
	     title="permalink">${bucket['meta']['key'] | h}</a></td>
    </tr>
    <tr>
      <th>date</th>
      <td>${bucket['meta']['date'] | h}</td>
    </tr>
    %if bucket['info']:
    %for (key, value) in bucket['info'].items():
    <tr>
      <th>${key | h}</th>
      <td>${value | h}</td>
    </tr>
    %endfor
    %endif
    %if non_images:
    <tr>
      <th>files</th>
      <td>
	%for item in non_images:
	<a href="${bucket['url'] + item.name | h}"
	   title="${item.info | h}">${item.name}</a>
	%endfor
      </td>
    </tr>
    %endif
  </table>

  %if images:
  %if tn:
  <table class="thumbnails">
    <tr>
      <th>images</th>
      <td>
	%for item in images:
	<a href="${bucket['url'] + item.name | h}">
	  <img class="thumbnail"
	       src="${bucket['url'] + item.tn_name | h}"
	       title="${item.name + ' ' + item.info | h}"
	       alt="${item.name | h}" /></a>
	%endfor
      </td>
    </tr>
  </table>
  %else:
  <table class="images">
    <tr>
      <th>images</th>
      <td>
	%for item in images:
	<div><img src="${bucket['url'] + item.name | h}" /><br />
	  ${item.name + ' ' + item.info | h}</div>
	%endfor
      </td>
    </tr>
  </table>
  %endif
  %endif

  <hr class="clear">
</div>
