/*
 * @license
 * Copyright (c) 2010 Mozilla Corporation
 * Copyright (c) 2010 Vladimir Vukicevic
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 */
const MJS_VERSION=0;const MJS_DO_ASSERT=true;try{WebGLFloatArray}catch(x){WebGLFloatArray=Float32Array}const MJS_FLOAT_ARRAY_TYPE=WebGLFloatArray;if(MJS_DO_ASSERT){function MathUtils_assert(n,e){if(!n)throw"Assertion failed: "+e}}else{function MathUtils_assert(){}}var V3={};V3._temp1=new MJS_FLOAT_ARRAY_TYPE(3);V3._temp2=new MJS_FLOAT_ARRAY_TYPE(3);V3._temp3=new MJS_FLOAT_ARRAY_TYPE(3);if(MJS_FLOAT_ARRAY_TYPE==Array){V3.x=[1,0,0];V3.y=[0,1,0];V3.z=[0,0,1];V3.$=function n(e,t,r){return[e,t,r]};V3.clone=function e(n){return[n[0],n[1],n[2]]}}else{V3.x=new MJS_FLOAT_ARRAY_TYPE([1,0,0]);V3.y=new MJS_FLOAT_ARRAY_TYPE([0,1,0]);V3.z=new MJS_FLOAT_ARRAY_TYPE([0,0,1]);V3.$=function t(n,e,r){return new MJS_FLOAT_ARRAY_TYPE([n,e,r])};V3.clone=function r(n){return new MJS_FLOAT_ARRAY_TYPE(n)}}V3.u=V3.x;V3.v=V3.y;V3.add=function _(n,e,t){if(t===undefined)t=new MJS_FLOAT_ARRAY_TYPE(3);t[0]=n[0]+e[0];t[1]=n[1]+e[1];t[2]=n[2]+e[2];return t};V3.sub=function a(n,e,t){if(t===undefined)t=new MJS_FLOAT_ARRAY_TYPE(3);t[0]=n[0]-e[0];t[1]=n[1]-e[1];t[2]=n[2]-e[2];return t};V3.neg=function u(n,e){if(e===undefined)e=new MJS_FLOAT_ARRAY_TYPE(3);e[0]=-n[0];e[1]=-n[1];e[2]=-n[2];return e};V3.direction=function M(n,e,t){if(t===undefined)t=new MJS_FLOAT_ARRAY_TYPE(3);return V3.normalize(V3.sub(n,e,t),t)};V3.length=function A(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2])};V3.lengthSquared=function i(n){return n[0]*n[0]+n[1]*n[1]+n[2]*n[2]};V3.normalize=function f(n,e){if(e===undefined)e=new MJS_FLOAT_ARRAY_TYPE(3);var t=1/V3.length(n);e[0]=n[0]*t;e[1]=n[1]*t;e[2]=n[2]*t;return e};V3.scale=function o(n,e,t){if(t===undefined)t=new MJS_FLOAT_ARRAY_TYPE(3);t[0]=n[0]*e;t[1]=n[1]*e;t[2]=n[2]*e;return t};V3.dot=function x(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]};V3.cross=function T(n,e,t){if(t===undefined)t=new MJS_FLOAT_ARRAY_TYPE(3);t[0]=n[1]*e[2]-n[2]*e[1];t[1]=n[2]*e[0]-n[0]*e[2];t[2]=n[0]*e[1]-n[1]*e[0];return t};var M4x4={};M4x4._temp1=new MJS_FLOAT_ARRAY_TYPE(16);M4x4._temp2=new MJS_FLOAT_ARRAY_TYPE(16);if(MJS_FLOAT_ARRAY_TYPE==Array){M4x4.I=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];M4x4.$=function c(n,e,t,r,_,a,u,M,A,i,f,o,x,T,R,m){return[n,e,t,r,_,a,u,M,A,i,f,o,x,T,R,m]};M4x4.clone=function R(n){return new[n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11]]}}else{M4x4.I=new MJS_FLOAT_ARRAY_TYPE([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);M4x4.$=function m(n,e,t,r,_,a,u,M,A,i,f,o,x,T,c,R){return new MJS_FLOAT_ARRAY_TYPE([n,e,t,r,_,a,u,M,A,i,f,o,x,T,c,R])};M4x4.clone=function Y(n){return new MJS_FLOAT_ARRAY_TYPE(n)}}M4x4.identity=M4x4.I;M4x4.topLeft3x3=function l(n,e){if(e===undefined)e=new MJS_FLOAT_ARRAY_TYPE(9);e[0]=n[0];e[1]=n[1];e[2]=n[2];e[3]=n[4];e[4]=n[5];e[5]=n[6];e[6]=n[8];e[7]=n[9];e[8]=n[10];return e};M4x4.inverseOrthonormal=function S(n,e){if(e===undefined)e=new MJS_FLOAT_ARRAY_TYPE(16);M4x4.transpose(n,e);var t=[n[12],n[13],n[14]];e[3]=e[7]=e[11]=0;e[12]=-Vec3.dot([e[0],e[4],e[8]],t);e[13]=-Vec3.dot([e[1],e[5],e[9]],t);e[14]=-Vec3.dot([e[2],e[6],e[10]],t);return e};M4x4.inverseTo3x3=function s(n,e){if(e===undefined)e=new MJS_FLOAT_ARRAY_TYPE(9);var t=n[10]*n[5]-n[6]*n[9],r=-n[10]*n[1]+n[2]*n[9],_=n[6]*n[1]-n[2]*n[5],a=-n[10]*n[4]+n[6]*n[8],u=n[10]*n[0]-n[2]*n[8],M=-n[6]*n[0]+n[2]*n[4],A=n[9]*n[4]-n[5]*n[8],i=-n[9]*n[0]+n[1]*n[8],f=n[5]*n[0]-n[1]*n[4];var o=n[0]*t+n[1]*a+n[2]*A;if(o===0)throw"matrix not invertible";var x=1/o;e[0]=x*t;e[1]=x*r;e[2]=x*_;e[3]=x*a;e[4]=x*u;e[5]=x*M;e[6]=x*A;e[7]=x*i;e[8]=x*f;return e};M4x4.makeFrustum=function d(n,e,t,r,_,a,u){if(u===undefined)u=new MJS_FLOAT_ARRAY_TYPE(16);var M=2*_/(e-n);var A=2*_/(r-t);var i=(e+n)/(e-n);var f=(r+t)/(r-t);var o=-(a+_)/(a-_);var x=-2*a*_/(a-_);u[0]=2*_/(e-n);u[1]=0;u[2]=0;u[3]=0;u[4]=0;u[5]=2*_/(r-t);u[6]=0;u[7]=0;u[8]=(e+n)/(e-n);u[9]=(r+t)/(r-t);u[10]=-(a+_)/(a-_);u[11]=-1;u[12]=0;u[13]=0;u[14]=-2*a*_/(a-_);u[15]=0;return u};M4x4.makePerspective=function V(n,e,t,r,_){var a=t*Math.tan(n*Math.PI/360);var u=-a;var M=u*e;var A=a*e;return M4x4.makeFrustum(M,A,u,a,t,r,_)};M4x4.makeOrtho=function O(n,e,t,r,_,a,u){if(u===undefined)u=new MJS_FLOAT_ARRAY_TYPE(16);var M=-(e+n)/(e-n);var A=-(r+t)/(r-t);var i=-(a+_)/(a-_);var f=2/(e-n);var o=2/(r-t);var x=-2/(a-_);u[0]=2/(e-n);u[1]=0;u[2]=0;u[3]=0;u[4]=0;u[5]=2/(r-t);u[6]=0;u[7]=0;u[8]=0;u[9]=0;u[10]=-2/(a-_);u[11]=0;u[12]=-(e+n)/(e-n);u[13]=-(r+t)/(r-t);u[14]=-(a+_)/(a-_);u[15]=0;return u};M4x4.makeOrtho2D=function F(n,e,t,r,_){return M4x4.makeOrtho(n,e,t,r,-1,1,_)};M4x4.mul=function L(n,e,t){if(t===undefined)t=new MJS_FLOAT_ARRAY_TYPE(16);t[0]=e[0]*n[0]+e[0+1]*n[4]+e[0+2]*n[8]+e[0+3]*n[12];t[0+1]=e[0]*n[1]+e[0+1]*n[5]+e[0+2]*n[9]+e[0+3]*n[13];t[0+2]=e[0]*n[2]+e[0+1]*n[6]+e[0+2]*n[10]+e[0+3]*n[14];t[0+3]=e[0]*n[3]+e[0+1]*n[7]+e[0+2]*n[11]+e[0+3]*n[15];t[4]=e[4]*n[0]+e[4+1]*n[4]+e[4+2]*n[8]+e[4+3]*n[12];t[4+1]=e[4]*n[1]+e[4+1]*n[5]+e[4+2]*n[9]+e[4+3]*n[13];t[4+2]=e[4]*n[2]+e[4+1]*n[6]+e[4+2]*n[10]+e[4+3]*n[14];t[4+3]=e[4]*n[3]+e[4+1]*n[7]+e[4+2]*n[11]+e[4+3]*n[15];t[8]=e[8]*n[0]+e[8+1]*n[4]+e[8+2]*n[8]+e[8+3]*n[12];t[8+1]=e[8]*n[1]+e[8+1]*n[5]+e[8+2]*n[9]+e[8+3]*n[13];t[8+2]=e[8]*n[2]+e[8+1]*n[6]+e[8+2]*n[10]+e[8+3]*n[14];t[8+3]=e[8]*n[3]+e[8+1]*n[7]+e[8+2]*n[11]+e[8+3]*n[15];t[12]=e[12]*n[0]+e[12+1]*n[4]+e[12+2]*n[8]+e[12+3]*n[12];t[12+1]=e[12]*n[1]+e[12+1]*n[5]+e[12+2]*n[9]+e[12+3]*n[13];t[12+2]=e[12]*n[2]+e[12+1]*n[6]+e[12+2]*n[10]+e[12+3]*n[14];t[12+3]=e[12]*n[3]+e[12+1]*n[7]+e[12+2]*n[11]+e[12+3]*n[15];return t};M4x4.makeRotate=function v(n,e,t){if(t===undefined)t=new MJS_FLOAT_ARRAY_TYPE(16);e=V3.normalize(e);var r=e[0],_=e[1],a=e[2];var u=Math.cos(n);var M=1-u;var A=Math.sin(n);t[0]=r*r*M+u;t[1]=_*r*M+a*A;t[2]=a*r*M-_*A;t[3]=0;t[4]=r*_*M-a*A;t[5]=_*_*M+u;t[6]=_*a*M+r*A;t[7]=0;t[8]=r*a*M+_*A;t[9]=_*a*M-r*A;t[10]=a*a*M+u;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return t};M4x4.rotate=function E(n,e,t,r){M4x4.makeRotate(n,e,M4x4._temp1);return M4x4.mul(t,M4x4._temp1,r)};M4x4.makeScale3=function J(n,e,t,r){if(r===undefined)r=new MJS_FLOAT_ARRAY_TYPE(16);r[0]=n;r[1]=0;r[2]=0;r[3]=0;r[4]=0;r[5]=e;r[6]=0;r[7]=0;r[8]=0;r[9]=0;r[10]=t;r[11]=0;r[12]=0;r[13]=0;r[14]=0;r[15]=1;return r};M4x4.makeScale1=function P(n,e){return M4x4.makeScale3(n,n,n,e)};M4x4.makeScale=function w(n,e){return M4x4.makeScale3(n[0],n[1],n[2],e)};M4x4.scale3=function p(n,e,t,r,_){M4x4.makeScale3(n,e,t,M4x4._temp1);return M4x4.mul(r,M4x4._temp1,_)};M4x4.scale1=function k(n,e,t){M4x4.makeScale3(n,n,n,M4x4._temp1);return M4x4.mul(e,M4x4._temp1,t)};M4x4.scale=function h(n,e,t){M4x4.makeScale3(n[0],n[1],n[2],M4x4._temp1);return M4x4.mul(e,M4x4._temp1,t)};M4x4.makeTranslate3=function y(n,e,t,r){if(r===undefined)r=new MJS_FLOAT_ARRAY_TYPE(16);r[0]=1;r[1]=0;r[2]=0;r[3]=0;r[4]=0;r[5]=1;r[6]=0;r[7]=0;r[8]=0;r[9]=0;r[10]=1;r[11]=0;r[12]=n;r[13]=e;r[14]=t;r[15]=1;return r};M4x4.makeTranslate1=function z(n,e){return M4x4.makeTranslate3(n,n,n,e)};M4x4.makeTranslate=function b(n,e){return M4x4.makeTranslate3(n[0],n[1],n[2],e)};M4x4.translate3=function I(n,e,t,r,_){M4x4.makeTranslate3(n,e,t,M4x4._temp1);return M4x4.mul(r,M4x4._temp1,_)};M4x4.translate1=function g(n,e,t){M4x4.makeTranslate3(n,n,n,M4x4._temp1);return M4x4.mul(e,M4x4._temp1,t)};M4x4.translate=function $(n,e,t){M4x4.makeTranslate3(n[0],n[1],n[2],M4x4._temp1);return M4x4.mul(e,M4x4._temp1,t)};M4x4.makeLookAt=function D(n,e,t,r){var _=V3.direction(n,e,V3._temp1);var a=V3.normalize(V3.cross(t,_,V3._temp2),V3._temp2);var u=V3.normalize(V3.cross(_,a,V3._temp3),V3._temp3);var M=M4x4._temp1;var A=M4x4._temp2;M[0]=a[0];M[1]=u[0];M[2]=_[0];M[3]=0;M[4]=a[1];M[5]=u[1];M[6]=_[1];M[7]=0;M[8]=a[2];M[9]=u[2];M[10]=_[2];M[11]=0;M[12]=0;M[13]=0;M[14]=0;M[15]=1;A[0]=1;A[1]=0;A[2]=0;A[3]=0;A[4]=0;A[5]=1;A[6]=0;A[7]=0;A[8]=0;A[9]=0;A[10]=1;A[3]=0;A[0]=-n[0];A[1]=-n[1];A[2]=-n[2];A[3]=0;if(r===undefined)r=new MJS_FLOAT_ARRAY_TYPE(16);return M4x4.mul(M,A,r)};M4x4.transpose=function G(n,e){if(n===e){var t=0;t=n[1];n[1]=n[4];n[4]=t;t=n[2];n[2]=n[8];n[8]=t;t=n[3];n[3]=n[12];n[12]=t;t=n[6];n[6]=n[9];n[9]=t;t=n[7];n[7]=n[13];n[13]=t;t=n[11];n[11]=n[14];n[14]=t;return n}if(e===undefined)e=new MJS_FLOAT_ARRAY_TYPE(16);e[0]=n[0];e[1]=n[4];e[2]=n[8];e[3]=n[12];e[4]=n[1];e[5]=n[5];e[6]=n[9];e[7]=n[13];e[8]=n[2];e[9]=n[6];e[10]=n[10];e[11]=n[14];e[12]=n[3];e[13]=n[7];e[14]=n[11];e[15]=n[15];return e};
