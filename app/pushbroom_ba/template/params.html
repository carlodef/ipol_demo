<body onload=draw_previous_points()>

<script type="text/javascript">
// Popup window code
function Popup(url) {
   popupWindow = window.open(url,'help','height=400,width=800,left=10,top=10,resizable=yes,scrollbars=yes,toolbar=no,menubar=no,location=no,directories=no,status=no')
}
</script>

<%def name="textareaAuto(name,defaultvalue,tagproperties='')">
   <%
   if name in app.cfg['param'] and app.cfg['param'][name] !='':
      value = app.cfg['param'][name]
   else:
      value = defaultvalue
   endif
   %>
   <input type="text" ${tagproperties} id="${name}" name="${name}" value="${value}"  />
</%def>

<%
  width  = 400
  height = 400
%>

<form name="theform" action="${app.base_url + 'browser_error'}" method="post">
  <input type="hidden" name="key" value="${app.key}">
  <input type="hidden" name="points_x" value="" id="points_x">
  <input type="hidden" name="points_y" value="" id="points_y">
  <p>
    Click on the image domain to add or remove ground control points.
    <input type="button"  value="Add" onclick="add_noise()"> <input type="text"
    id="noise_points" value="10" style="width:20px"> random points.
  </p>


<!-- DIV CONTAINER TO DRAW POINTS -->
<div id="canvas_div" onclick="click_point(event)" style = "width:${width}px;
    height:${height}px; border: 1px solid black">
</div>

<div style="float:left; width:100%;">
    <fieldset style="padding-top:0.0ex">
        <legend style="font-weight:bold;">Perturbate coordinates</legend>
        <span style="float:left; margin-right:2em">
            Add zero-mean Gaussian random variables to the image and 3-space
            point coordinates.<br>
            <span style="float:left; margin-left:1em">
                image sigma: ${textareaAuto('sigma_pixels','0.2', 'size="5"')}
                pixels<br>
                space sigma: ${textareaAuto('sigma_meters','0.1', 'size="5"')}
                meters<br>
            </span>
        </span>
    </fieldset>
</div>

  <input type="submit" name="action" value="Run the algorithm"
         onClick="return checkPoints('${app.base_url + 'wait'}');" >
</form>

<!-- IMPORT RAPHAEL JAVASCRIPT DRAWING LIBRARY -->
<script language="JavaScript">
  <%include file="raphael.js" />
</script>

<!-- JAVASCRIPT CODE TO MARK POINTS -->
<script language="JavaScript">
  // max width and height
  WIDTH=${width};
  HEIGHT=${height};

  // array containers of lists of point coordinates
  %if prev_points:
    var prev_points=${prev_points};  // fill with previous points
  %else:
    var prev_points=[];
  %endif

  <%include file="draw_points.js" />
</script>
<!-- END JAVASCRIPT -->
